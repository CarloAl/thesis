<html>
<head>
    <title>CarSharing</title>
    
    <script type="text/javascript" src="/js/clientLib.js"></script>
    <script type= 'text/javascript'>




        //var connection = myWebSocket('ws://127.0.0.1:8080');
        //connection.onopen = function () {console.log("Websocket open");};
        //connection.onmessage = matchFound;
        
        //I could enforce here the return typed, ie if I am a taxi I want passenger a return type
        
        //matchfound should be a template not 'matchfound'.

        //mylib.onEvent('myevent',callback)



        function matchFound(data) {
            string = 'Match Found! Call ' + data.username + ' at ' + data.phone;
            document.getElementById('response').innerHTML += string; 
        };

        function sendSocket(){
            if(document.getElementById('istaxi').checked)
                addEventListener('passenger',matchFound);
            else
                addEventListener('taxi',matchFound);
            //recupare the data from the form to assert a new fact
            var obj = { 
                destination: document.getElementById('destination').value,
                person: document.getElementById('passenger').value,
                price: document.getElementById('price').value,
                radius: document.getElementById('radius').value,
                lat: document.getElementById('latitude').value,
                long: document.getElementById('longitude').value,
                username: document.getElementById('username').value,
                phone: document.getElementById('number').value, 
                time: document.getElementById('time').value 
                //__templateId : document.getElementById('istaxi').checked?'0':'1'
            }


            /* the way I d want it:
            if(document.getElementById('istaxi').checked)
                var Template = require("Taxi");
            else
                var Template = require("Passenger");
            var fact = new Template(obj);
            sendNewFact(fact);
            */
            



            var f = function(Template){
                    var fact = new Template(obj);
                    sendNewFact(fact);        
                }

            if(document.getElementById('istaxi').checked)
                //require ask for the definition of one or more "class" to the server. Last paramenter is the callback

                require("Taxi","Passenger",f);//add erro
            else
                require("Passenger","Taxi",f);
            


        }
    </script>
    
</head>
<body>
     <form name='data' style="text-align:center">
            <h2 >Insert your data </h2>
            <input  type="radio" name="taxi" id="istaxi" value="taxi" >Offer a lift
            <input  type="radio" name="taxi" id="ispassenger" value="passenger" checked>Looking for a lift<br>
            Name: <input  placeholder = '' type='text' name='username' id='username' value='carlo'><br>
            Destination: <input type='text' name='destination' id='destination' value='VUB'><br>
            Passenger: <input type='text' name='passenger' id='passenger' value="3"><br>
            Price: <input type='text' name='price' id='price' value="10"><br>
            Radius[km]: <input type='text' name='radius' id='radius' value="3"><br>
            Latitude: <input type='text' name='latitude' id='latitude' value="7.39"><br>
            Longitude: <input type='text' name='longitude' id='longitude' value="52.12"><br>
            Leaving time: <input type='time' name='time' id='time' value="14:32"><br>
            Phone number: <input type='number' name='number' id='number' value="04756323"><br>
            <button class="btn btn-lg btn-primary btn-block" type="button" onclick="sendSocket()">Submit</button>
        </form>

        <div id='response'>
        </div>


</body>
</html>